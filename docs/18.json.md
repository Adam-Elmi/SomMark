## JSON Mapper
This mapper generates valid JSON output from SomMark source files.

The JSON mapper works differently from other mappers. Rather than mapping SomMark elements to text snippets, it processes the **AST directly** to construct a full JSON structure. There are no arbitrary custom elements — only a fixed set of reserved identifiers.

---

### Root Block: Json

Every JSON document must begin with a `Json` block at the top level. It defines whether the root of the JSON output is an object or an array.

**Identifier:** `Json`

**Arguments:** `object` or `array`

```ini
[Json = object]
  ...
[end]
```

```ini
[Json = array]
  ...
[end]
```

---

### Structural Blocks

#### Object

Defines a JSON object (`{}`). When nested inside another `Object`, its first argument is used as the **key**.

**Identifier:** `Object`

- Inside an `Object` → requires a key argument: `[Object = myKey]`
- Inside an `Array` or as root → no key needed: `[Object]`

```ini
[Json = object]
  [Object = compilerOptions]
    (strict)->(bool: true)
  [end]
[end]
```

**Output:**
```json
{"compilerOptions":{"strict":true}}
```

---

#### Array

Defines a JSON array (`[]`). When nested inside an `Object`, its first argument is the **key**.

**Identifier:** `Array`

- Inside an `Object` → requires a key argument: `[Array = items]`
- Inside an `Array` or as root → no key needed: `[Array]`

```ini
[Json = object]
  [Array = tags]
    (Initial Release)->(string: v1)
    (Latest Release)->(string: v2)
    (Next Release)->(string: v3)
  [end]
[end]
```

**Output:**
```json
{"tags":["v1","v2","v3"]}
```

---

### Inline Types

Inline statements are used to define values. The **inline value** (left of `->`) is the **key** when inside an `Object`, and the identifier after `->` is the **type**.

Syntax: `(key)->(type: value)`

#### string

Outputs a JSON string value. The value is automatically quoted and escaped.

```ini
[Json = object]
(target)->(string: es2022)
[end]
```

**Inside an object:**
```json
{"target":"es2022"}
```

---

#### number

Outputs a JSON number value. Must be a valid number.

```ini
[Json = object]
(port)->(number: 8080)
[end]
```

**Inside an object:**
```json
{"port":8080}
```

---

#### bool

Outputs a JSON boolean. Value must be exactly `true` or `false`.

```ini
[Json = object]
(strict)->(bool: true)
(debug)->(bool: false)
[end]
```

**Inside an object:**
```json
{"strict":true,"debug":false}
```

---

#### null

Outputs a JSON `null` value. No arguments needed.

```ini
[Json = object]
(value)->(null)
[end]
```

**Inside an object:**
```json
{"value":null}
```

---

#### array

Outputs a compact inline JSON array. Values are comma-separated in the arguments. Each value is auto-typed: booleans, numbers, and `null` are output as their native JSON types; everything else becomes a string.

```ini
[Json = object]
(lib)->(array: esnext, dom, dom.iterable)
[end]
```

**Inside an object:**
```json
{"lib":["esnext","dom","dom.iterable"]}
```

---

#### none

Outputs a value directly without a key. Only valid inside an `Array` — **not allowed inside an `Object`**.

- **Single value:** outputs the value as-is (auto-typed).
- **Multiple values:** outputs a JSON array.

```ini
[Json = array]
  (-)->(none: hello)
  (-)->(none: 1, 2, 3)
[end]
```

**Output:**
```json
["hello",[1,2,3]]
```

---

### Auto-Typing Rules

For `array` and `none`, values in the argument list are automatically typed:

| Value              | JSON Output      |
|--------------------|------------------|
| `null`             | `null`           |
| `true` / `false`   | `true` / `false` |
| Valid number       | `42` / `3.14`    |
| Anything else      | `"string value"` |

---

### Nesting Rules

| Context       | Allowed children                          |
|---------------|-------------------------------------------|
| `Json`        | `Object`, `Array`, inline types           |
| `Object`      | `Object` (with key), `Array` (with key), inline types (with key) |
| `Array`       | `Object` (no key), `Array` (no key), `none` |

> Inline elements inside an `Object` must always have a key (the inline value). Using `none` inside an `Object` is an error.

---

### Full Example

```ini
[Json = object]
  [Object = compilerOptions]
    (target)->(string: es2022)
    (strict)->(bool: true)
    (port)->(number: 3000)
    (alias)->(null)
    (lib)->(array: esnext, dom)

    [Array = paths]
      [Object]
        (@/*)->(array: ./src/*)
      [end]
    [end]
  [end]

  (include)->(array: src/**/*)
  (exclude)->(array: node_modules, dist)
[end]
```

**Output:**
```json
{"compilerOptions":{"target":"es2022","strict":true,"port":3000,"alias":null,"lib":["esnext","dom"],"paths":[{"@/*":["./src/*"]}]},"include":["src/**/*"],"exclude":["node_modules","dist"]}
```

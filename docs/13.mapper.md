# Mapper API Reference (Simplified)

The **Mapper** class is the core of SomMark’s extensibility. It lets you create **custom blocks, inline statements, or At-Blocks** and define how they render into HTML, Markdown, or other formats.

```javascript
import { Mapper } from "sommark";

const myMapper = new Mapper();
```

---

## 1. Register Custom Tags

Use `register()` to define new blocks or inline elements.

**Syntax:**

```javascript
mapper.register("Identifier", RendererFunction, options?)
```

- **Identifier** → Name of the block or inline
- **RendererFunction** → Function that returns output (HTML/Markdown)
- **options** → Optional rules and settings

### Example: YouTube Block

```javascript
myMapper.register("YouTube", ({ args }) => {
	return myMapper
		.tag("iframe")
		.attributes({ src: `https://youtube.com/embed/${args[0]}` })
		.body("");
});
```

**SomMark usage:**

```ini
[YouTube = dQw4w9WgXcQ][end]
```

### Example: Alert Block

```javascript
myMapper.register("Alert", ({ content }) => {
	return `<div class="alert alert-warning">${content}</div>`;
});
```

```ini
[Alert]Warning! Something went wrong.[end]
```

---

## 2. Validation Rules

### Argument Rules

Control what arguments are allowed:

```javascript
myMapper.register(
	"User",
	({ args }) => {
		return `<div>User: ${args[0]}</div>`;
	},
	{
		rules: {
			args: {
				min: 1, // At least 1 argument
				max: 3, // Maximum 3 arguments
				required: ["id"], // Key "id" is required
				includes: ["id", "role", "age"] // Only these keys allowed
			}
		}
	}
);
```

### Content Rules

Control the block body:

```javascript
myMapper.register(
	"Summary",
	({ content }) => {
		return `<p>${content}</p>`;
	},
	{
		rules: {
			content: { maxLength: 100 } // Max 100 characters
		}
	}
);
```

### Self-Closing Blocks

Ensure a block has **no content**:

```javascript
myMapper.register("Separator", () => `<hr/>`, {
	rules: { is_Self_closing: true }
});
```

### Element Type

Ensure element type has to be expected type:

* Type that can be passed: `Block` | `Inline` | `Atblock`

```javascript
myMapper.register("Summary", ({content}) => {
  return myMapper.tag("p").body(content);
}), {
  rules: { type: "Block" }
});
```

```javascript
myMapper.register("Separator", () => {
  return myMapper.tag("hr").selfClose();
}), {
  rules: { type: "Block" }
});
```

---

## 3. Options

You can set options like `escape: false` or pass validation rules:

```javascript
myMapper.register(
	"Code",
	({ content }) => {
		return `<pre>${content}</pre>`;
	},
	{
		escape: false,
		rules: {
			args: { min: 1, required: ["id"] }
		}
	}
);
```

---

## 4. Adding Styles

Use `addStyle()` to inject CSS into the output:

```javascript
myMapper.addStyle(`
.alert {
  padding: 10px;
  background: yellow;
  border: 1px solid orange;
}
`);
```

---

## 5. HTML Helpers

`tag(name)` creates HTML safely:

```javascript
myMapper.register("Card", ({ content }) => {
	return myMapper.tag("div").attributes({ class: "card" }).body(content);
});
```

---

## 6. Key Mapper Methods

| Method                     | Description                                |
| -------------------------- | ------------------------------------------ |
| `register()`               | Register a new block, inline, or At-Block. |
| `get()`                    | Get a registered mapping.                  |
| `removeOutput()`           | Remove a mapping.                          |
| `includesId()`             | Check if an ID exists in arguments.        |
| `outputs`                  | List of all registered mappings.           |
| `env`                      | Current environment (`node` / `browser`).  |
| `addStyle()`               | Add custom CSS.                            |
| `styles`                   | Array of registered CSS strings.           |
| `highlightCode()`          | Highlight code strings.                    |
| `registerHighlightTheme()` | Register a custom theme.                   |
| `selectHighlightTheme()`   | Select an active theme.                    |
| `enable_highlightTheme()`  | Toggle automatic theme injection.          |
| `tag()`                    | Create safe HTML tags.                     |
| `md()`                     | Markdown builder.                          |
| `code()`                   | Code block formatter.                      |
| `htmlTable()`              | Generate HTML tables.                      |
| `list()`                   | Generate HTML lists.                       |
| `todo()`                   | Parse todo items.                          |
| `escapeHTML()`             | Escape special HTML characters.            |
| `pageProps()`              | Store page metadata.                       |
| `header()`                 | Full document header string.               |
| `setHeader()`              | Add custom header content.                 |
| `enable_table_styles()`    | Toggle default table styles.               |

---

This gives a **clear and compact reference** for creating custom mappers, validating content, and using built-in helpers in SomMark.
